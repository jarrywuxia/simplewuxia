rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // --- PLAYER DATA (The Bank Vault) ---
    match /players/{userId} {
      // 1. READ: You can see your own stats
      allow read: if request.auth != null && request.auth.uid == userId;
      
      // 2. WRITE (Create/Update/Delete): COMPLETELY BLOCKED.
      // Character creation is now handled by the secure 'createCharacter' Cloud Function.
      // This prevents the "God Mode" hack where clients inject fake stats.
      // Cloud Functions (Admin SDK) bypass these rules automatically.
      allow write: if false;
    }
    
    // --- USERNAMES (The Registry) ---
    match /usernames/{username} {
      // Allow reading so the UI can quickly check if a name exists (optional)
      allow read: if request.auth != null;
      
      // WRITE: BLOCKED.
      // The 'createCharacter' Cloud Function handles name claiming securely.
      // This prevents users from stealing names or corrupting the registry.
      allow write: if false;
    }
    
    // --- SAFETY NET ---
    // Block everything else by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}